<!DOCTYPE html>
<html lang="en">
  <head>
    <title>  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset="utf-8">
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
    <script src="js/lunr.min.js" defer></script>
    <script src="js/typeahead.jquery.js" defer></script>
    <script src="js/jazzy.search.js" defer></script>
  </head>
  <body>


    <a title="  Reference"></a>

    <header class="header">
      <p class="header-col header-col--primary">
        <a class="header-link" href="index.html">
           Docs
        </a>
        
      </p>
    
      <p class="header-col--secondary">
        <form role="search" action="search.json">
          <input type="text" placeholder="Search documentation" data-typeahead>
        </form>
      </p>
    
        <p class="header-col header-col--secondary">
          <a class="header-link" href="https://github.com/eonfluxor/Flask/">
            <img class="header-icon" src="img/gh.png"/>
            View on GitHub
          </a>
        </p>
    
    </header>

    <p class="breadcrumbs">
      <a class="breadcrumb" href="index.html"> Reference</a>
      <img class="carat" src="img/carat.png" />
        Reference
    </p>

    <div class="content-wrapper">
      <nav class="navigation">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Guides.html">Guides</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="examples.html">Examples</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="gists.html">Gists</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="guides.html">Guides</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Classes.html">Classes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/ChainReaction.html">ChainReaction</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/Flask.html">Flask</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/FlaskDictRef.html">FlaskDictRef</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/FlaskEquatable.html">FlaskEquatable</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/FlaskNSRef.html">FlaskNSRef</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/FlaskOperation.html">FlaskOperation</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/FlaskReaction.html">FlaskReaction</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes.html#/s:9Flask_iOS0A7WeakRefC">FlaskWeakRef</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/Flux.html">Flux</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/FluxLock.html">FluxLock</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/FluxNotifier.html">FluxNotifier</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/FluxObserver.html">FluxObserver</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/ReactiveSubstance.html">ReactiveSubstance</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/Reactor.html">Reactor</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/ReactorConcrete.html">ReactorConcrete</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/ReactorManager.html">ReactorManager</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes.html#/s:9Flask_iOS9SubstanceC">Substance</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/SubstanceConcrete.html">SubstanceConcrete</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/SubstanceSerializer.html">SubstanceSerializer</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Enums.html">Enumerations</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/NoMixers.html">NoMixers</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Extensions.html">Extensions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/OperationQueue.html">OperationQueue</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Functions.html">Functions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Functions.html#/s:9Flask_iOS11isNilorNullSbypSgF">isNilorNull(_:)</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Protocols.html">Protocols</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/FlaskReactor.html">FlaskReactor</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/State.html">State</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/StateSerializer.html">StateSerializer</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Structs.html">Structures</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/FluxNotification.html">FluxNotification</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/SubstanceChange.html">SubstanceChange</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Typealiases.html">Type Aliases</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Typealiases.html#/s:9Flask_iOS13ChangeClosurea">ChangeClosure</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Typealiases.html#/s:9Flask_iOS0A8DictTypea">FlaskDictType</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Typealiases.html#/s:9Flask_iOS16FluxEmptyClosurea">FluxEmptyClosure</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Typealiases.html#/s:9Flask_iOS19FluxMutationClosurea">FluxMutationClosure</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Typealiases.html#/s:9Flask_iOS23FluxNotificationClosurea">FluxNotificationClosure</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Typealiases.html#/s:9Flask_iOS15FluxPayloadTypea">FluxPayloadType</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Typealiases.html#/s:9Flask_iOS15MutationClosurea">MutationClosure</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Typealiases.html#/s:9Flask_iOS15ReactionClosurea">ReactionClosure</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Typealiases.html#/s:9Flask_iOS9StatePropa">StateProp</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Typealiases.html#/s:9Flask_iOS14SubstanceMixera">SubstanceMixer</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">

        <section class="section">
          <div class="section-content">
            
            <p><p align="center"> 
    <img src="http://res.cloudinary.com/dmje5xfzh/image/upload/c_scale,r_60,w_280/v1536646955/static/Flask-logo.png" alt="alternate text">
 </p></p>

<p><a href="#cocoapods"><img src="https://img.shields.io/cocoapods/v/Flask.svg" alt="CocoaPods compatible"></a> 
<a href="https://github.com/eonfluxor/flask/releases"><img src="https://img.shields.io/github/release/eonfluxor/flask.svg" alt="GitHub release"></a> 
<img src="https://img.shields.io/badge/Swift-4.1-orange.svg" alt="Swift 4.0"> 
<img src="https://img.shields.io/cocoapods/p/Flask.svg" alt="platforms">
<a href="https://travis-ci.org/eonfluxor/flask"><img src="https://travis-ci.org/eonfluxor/reactor.svg?branch=master" alt="Build Status"></a></p>
<h1 id='what-is-flask-reactor' class='heading'>What is Flask Reactor?</h1>

<p>Flask is a multiplatform <strong>[ iOS | OSX | tvOS ]</strong> implementation of the unidirectional data flow architecture in Swift. Flask offers a unique feature set beyond any similar frameworks through an <em>intuitive API</em></p>

<p>While the Flux architecture is abstract, explaining Flask is easy:</p>

<p><p align="center"> 
    <img src="http://res.cloudinary.com/dmje5xfzh/image/upload/c_scale,w_620/v1536896631/static/scheme01.jpg">
 </p></p>

<hr>

<blockquote>
<p><strong>Flask</strong> lets you <strong>Mix</strong> <strong>Substances</strong> and <strong>React</strong> to their <strong>State</strong> <strong>Changes</strong></p>
</blockquote>

<hr>

<p><strong>Easy right?</strong></p>

<p>As such to preserve this natural intuition  <code>Flux Stores</code> are called a <code><a href="Classes.html#/s:9Flask_iOS9SubstanceC">Substance</a></code>. In Flask a <code><a href="Classes.html#/s:9Flask_iOS9SubstanceC">Substance</a></code> would represent any homogeneous data structure in your application <em>(ie. a feed, settings, or the application itself).</em></p>

<p>Flask allows implementing both the <a href="https://github.com/reactjs/redux">Redux</a> and <a href="http://fluxxor.com/">Fluxor</a> patterns through a unified architecture. And although this integration may sound complicated, with Flask it&rsquo;s also easy to articulate:</p>

<hr>

<blockquote>
<p>Flask lets you create <strong>ReactiveSubstances</strong> that react to environmental events called <strong>Mixers</strong> as well as plain <strong>Substances</strong> meant to be <strong>Mixed</strong> inside a particular <strong>Flask</strong>.</p>
</blockquote>

<hr>

<p>This is a direct analogy between the <em>Fluxor</em> pattern of <code>Reactive Stores</code> as a <code><a href="Classes/ReactiveSubstance.html">ReactiveSubstance</a></code> and the <em>Redux</em> pattern of <code>Store Reducers</code>  as a plain <code><a href="Classes.html#/s:9Flask_iOS9SubstanceC">Substance</a></code>.</p>

<p>Using chemistry semantics is an intuitive way to approach the flux-reactive patterns. After all, the word <code>React</code> is itself defined <a href="https://dictionary.cambridge.org/us/dictionary/english/react">within the chemistry domain</a>.</p>
<h1 id='table-of-contents' class='heading'>Table of Contents</h1>

<ul>
<li><a href="#motivation">Motivation</a></li>
<li><a href="#why-flask">Why Flask?</a></li>
<li><a href="#cocoapods">CocoaPods Installation</a></li>
<li><a href="#architecture">Architecture</a></li>
<li><a href="#components">Components</a>

<ul>
<li><a href="#flask-api">Flask API</a></li>
<li><a href="#substances">Substances</a></li>
<li><a href="#mixers">Mixers</a></li>
<li><a href="#reactor">Reactor</a></li>
<li><a href="#flux">Flux</a></li>
</ul></li>
<li><a href="#implementation">Implementation</a>

<ul>
<li><a href="#redux-style">Redux Style</a></li>
<li><a href="#fluxor-style">Fluxor Style</a></li>
</ul></li>
<li><a href="#special-features">Special Features</a>

<ul>
<li><a href="#chain-reactions">Chained Reactions</a></li>
<li><a href="#locks">Flux Locks</a></li>
<li><a href="#async-mixing-with-locks">Async Flux</a></li>
<li><a href="#nested-structs">Nested Structs</a></li>
<li><a href="#nsobjects-and-dictionaries">NSObjects and Dictionaries</a></li>
<li><a href="#archiving">Archiving</a></li>
<li><a href="#internal-state-props">Internal Properties</a></li>
<li><a href="#low-level-api">Low-Level API</a></li>
</ul></li>
<li><a href="#documentation">Documentation</a></li>
</ul>
<h2 id='motivation' class='heading'>Motivation</h2>

<p>Flask Reactor is the foundation of a comprehensive toolbox defining the <q>Flask Pattern</q> as a way to create reactive applications in Apple&rsquo;s Swift platform. As such Flask delivers the most robust feature set through an intuitive API.</p>

<p>Flask goes beyond the novelty of the Reactive pattern to develop an expressive API using physical world analogies that are intuitive and easy to implement. All this while the core technology offers a unified implementation of both the <code>Redux</code> and <code>Fluxor</code> patterns and delivers advanced features not available in other frameworks (such as async-flux, locks and nested keys support). Such features are required for the development of higher-level frameworks (like the FlaskNavigation router or the FlaskAPI manager). </p>

<blockquote>
<p>Despite its power Flask is as easy to implement as the most popular frameworks (ie. ReSwift). Code complexity is optional and progressive depending on your own implementations.</p>
</blockquote>
<h2 id='why-flask' class='heading'>Why Flask?</h2>

<p>Flask provides unique features not found in similar frameworks:</p>

<ul>
<li>Chained mutations</li>
<li>Binding multiple stores</li>
<li>Structs reductions with nested keys</li>
<li>NSObject pointer change reduction with <code><a href="Classes/FlaskNSRef.html">FlaskNSRef</a></code></li>
<li>NSDictionary and Dictionary reduction supporting nested keys</li>
<li>Flux locks and exclusive dispatch</li>
<li>Automatic archiving to <code>UserDefaults</code></li>
<li>Managed attachment with automatic disposal</li>
<li>Friendly high-level API</li>
<li>Access to low-level API for more granular control</li>
<li>Mixed use of both Redux and Fluxor patterns</li>
</ul>
<h2 id='cocoapods' class='heading'>CocoaPods</h2>

<p>If you use <a href="https://cocoapods.org/pods/Flask">CocoaPods</a> , simply add <strong>Flask</strong> to your <code>Podfile</code>:</p>
<pre class="highlight ruby"><code><span class="n">pod</span> <span class="s1">'Flask'</span>
</code></pre>

<p>And then import the module</p>
<pre class="highlight swift"><code><span class="kd">import</span> <span class="kt">Flask</span>
</code></pre>
<h1 id='architecture' class='heading'>Architecture</h1>

<p><img src="http://res.cloudinary.com/dmje5xfzh/image/upload/v1537117496/static/flas-flow01.jpg" alt="image"></p>

<p>The above flowchart is an overview of the <code><a href="Classes/Flask.html">Flask</a></code> pipeline.</p>

<ul>
<li>Green are <code><a href="Classes/Reactor.html">Reactor</a></code> components</li>
<li>Blue are <code><a href="Classes/Flux.html">Flux</a></code> components</li>
<li>Pink are <code><a href="Classes.html#/s:9Flask_iOS9SubstanceC">Substance</a></code> components</li>
<li>Yellow are <code><a href="Protocols/State.html">State</a></code> representations</li>
</ul>
<h2 id='how-it-works' class='heading'>How it works?</h2>

<p>These are the main components to interface with Flask:</p>

<ul>
<li><strong>Substances:</strong> Any data structure in your application</li>
<li><strong>Mixers:</strong>  Transactional closures defining data mutations</li>
<li><strong>Reactors:</strong> Mixing Substances to produce reactions</li>
<li><strong>Flux:</strong>  The single unidirectional bus connecting the pipeline</li>
</ul>
<h1 id='components' class='heading'>Components</h1>
<h3 id='flask-api' class='heading'>Flask API</h3>

<p>These are the High-level API methods that you&rsquo;ll use more frequently:</p>
<pre class="highlight swift"><code><span class="c1">// Managing your reactor instance</span>
<span class="kt">Flask</span><span class="o">.</span><span class="nf">attachReactor</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span><span class="nv">mixing</span><span class="p">:)</span>
<span class="kt">Flask</span><span class="o">.</span><span class="nf">detachReactor</span><span class="p">(</span><span class="nv">from</span><span class="p">:)</span>
<span class="kt">Flask</span><span class="o">.</span><span class="nf">getReactor</span><span class="p">(</span><span class="nv">at</span><span class="p">:)</span>

<span class="c1">// Dispatching a substancer mixer</span>
<span class="kt">Flask</span><span class="o">.</span><span class="nf">substances</span><span class="p">(</span><span class="nv">reactTo</span><span class="p">:</span><span class="nv">payload</span><span class="p">:)</span>

<span class="c1">// Creating non-reactive substances</span>
<span class="kt">Flask</span><span class="o">.</span><span class="nf">newSubstance</span><span class="p">(</span><span class="nv">definedBy</span><span class="p">:)</span>
<span class="kt">Flask</span><span class="o">.</span><span class="nf">newSubstance</span><span class="p">(</span><span class="nv">definedBy</span><span class="p">:</span><span class="nv">named</span><span class="p">:</span><span class="nv">archive</span><span class="p">:)</span>
</code></pre>

<p>Inspect these methods to learn more about the low-level API.</p>
<h3 id='substances' class='heading'>Substances</h3>

<p>Substances are minimally initialized with a <code><a href="Protocols/State.html">State</a></code> structure. ReactiveSubstances require an additional <code><a href="Typealiases.html#/s:9Flask_iOS14SubstanceMixera">SubstanceMixer</a></code> enumeration to facilitate handling environmental mixers.</p>

<ul>
<li><strong>Substance:</strong> Easy to mutate using <code>Flask.mix</code></li>
<li><strong>ReactiveSubstance:</strong> Like Substances but also observing global Substance Mixers.</li>
</ul>

<p>Consider the following example:</p>

<blockquote>
<p>State</p>
</blockquote>
<pre class="highlight swift"><code><span class="kd">struct</span> <span class="kt">AppState</span> <span class="p">:</span> <span class="kt">State</span> <span class="p">{</span>
    <span class="kd">enum</span> <span class="nv">prop</span> <span class="p">:</span> <span class="kt">StateProp</span><span class="p">{</span>
        <span class="k">case</span> <span class="n">counter</span>
    <span class="p">}</span>
    <span class="k">var</span> <span class="nv">counter</span> <span class="o">=</span> <span class="mi">0</span>
<span class="p">}</span>
</code></pre>

<blockquote>
<p>Substance</p>
</blockquote>
<pre class="highlight swift"><code><span class="kd">class</span> <span class="kt">Feed</span> <span class="p">:</span> <span class="kt">Substance</span><span class="o">&lt;</span><span class="kt">AppState</span><span class="o">&gt;</span> <span class="p">{}</span>
</code></pre>

<blockquote>
<p>Reactive Substance</p>
</blockquote>
<pre class="highlight swift"><code><span class="kd">enum</span> <span class="kt">Mixers</span> <span class="p">:</span> <span class="kt">SubstanceMixer</span> <span class="p">{</span>
    <span class="k">case</span> <span class="kt">Login</span>
<span class="p">}</span>
<span class="kd">class</span> <span class="kt">App</span> <span class="p">:</span> <span class="kt">ReactiveSubstance</span><span class="o">&lt;</span><span class="kt">AppState</span><span class="p">,</span><span class="kt">Mixers</span><span class="o">&gt;</span> <span class="p">{</span>

    <span class="k">override</span> <span class="kd">func</span> <span class="nf">defineMixers</span><span class="p">(){</span>
        <span class="nf">define</span><span class="p">(</span><span class="nv">mix</span><span class="p">:</span> <span class="o">.</span> <span class="kt">Login</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">react</span><span class="p">,</span> <span class="n">abort</span><span class="p">)</span>  <span class="k">in</span>
            <span class="k">self</span><span class="o">.</span><span class="n">prop</span><span class="o">.</span><span class="n">counter</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="n">prop</span><span class="o">.</span><span class="n">counter</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="nf">react</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>

<span class="p">}</span>
</code></pre>
<h3 id='mixers' class='heading'>Mixers</h3>

<p>Flask data mutations are performed using Mixers. A mixer is a transactional closure where you can access an modify given substance properties. There are two types of mixers:</p>

<ul>
<li><strong>Substance Mixer</strong> These are declared as enumerations and passed as part of a <code>ReactiveSubstace</code> subclass definition. Internally the substance optionally subscribes to the cases where it needs to respond with internal data mutations inside a State Transaction context.</li>
<li><strong>Flask Mixer</strong> These can be used anywhere by accessing the substances bound to a given <code><a href="Classes/Reactor.html">Reactor</a></code> instance. Calling <code>reactor.mix( substance)</code>lets you declare a closure that includes a weak pointer to the requested substance in a State Transaction context where you can mutate the substance properties.</li>
</ul>

<p>So while <em>Substance Mixers</em> can be applied across all substances sharing the same observers the <em>Flask Mixers</em> are intended for more specific transformations and had the advantage of mutating multiple substances through the use of a <code><a href="Classes/ChainReaction.html">ChainReaction</a></code>.</p>

<p>Consider the following samples:</p>

<blockquote>
<p>Global Substance Mixer. High-level API</p>
</blockquote>
<pre class="highlight swift"><code>  <span class="kt">Flask</span><span class="o">.</span><span class="nf">substances</span><span class="p">(</span><span class="nv">reactTo</span><span class="p">:</span><span class="kt">EnvMixers</span><span class="o">.</span><span class="kt">Login</span><span class="p">,</span> <span class="nv">payload</span><span class="p">:[</span><span class="s">"username"</span><span class="p">:</span><span class="s">"foo"</span><span class="p">])</span>
</code></pre>

<blockquote>
<p>Flask Mixer. High-level API</p>
</blockquote>
<pre class="highlight plaintext"><code> Flask.getReactor(attachedTo:self)
            .mixing(self.substance!) { (substance) in
                substance.prop.counter = 10
            }.with(self.substance!) { (substance) in
                substance.prop.text = "text"
            }.andReact()
</code></pre>
<h3 id='reactor' class='heading'>Reactor</h3>

<p>The <code><a href="Classes/Reactor.html">Reactor</a></code> instances (or <strong>reactor</strong> for short) are initialized by the <code><a href="Classes/ReactorManager.html">ReactorManager</a></code> factory by passing a weak <code>owner</code> reference and an array of <code>[substances]</code>. Internally the framework takes care of lazily unbinding and disposing of the instances which <code>owner</code> has become nil. </p>

<p>Each <code><a href="Classes/Reactor.html">Reactor</a></code> must define a handler closure where to receive the changes callbacks. You can see an example implementation here:</p>
<pre class="highlight swift"><code>    <span class="k">let</span> <span class="nv">reactor</span> <span class="o">=</span> <span class="kt">Flask</span><span class="o">.</span><span class="nf">reactor</span><span class="p">(</span><span class="nv">attachedTo</span><span class="p">:</span><span class="n">owner</span><span class="p">,</span><span class="nv">mixing</span><span class="p">:</span><span class="n">substance</span><span class="p">)</span>

    <span class="n">reactor</span><span class="o">.</span><span class="n">handler</span><span class="o">=</span><span class="p">{</span><span class="n">owner</span><span class="p">,</span> <span class="n">reaction</span> <span class="k">in</span>
        <span class="n">reaction</span><span class="o">.</span><span class="nf">on</span><span class="p">(</span><span class="kt">AppState</span><span class="o">.</span><span class="n">prop</span><span class="o">.</span><span class="n">counter</span><span class="p">,</span> <span class="p">{</span> <span class="p">(</span><span class="n">change</span><span class="p">)</span> <span class="k">in</span>
            <span class="n">expectation</span><span class="o">.</span><span class="nf">fulfill</span><span class="p">()</span>
        <span class="p">})</span>
    <span class="p">}</span>
</code></pre>

<p>The above implementation is conviently wrapped using the <code><a href="Protocols/FlaskReactor.html">FlaskReactor</a></code> protocol in which case the implementation looks like this:</p>
<pre class="highlight swift"><code><span class="kd">class</span> <span class="kt">ViewController</span><span class="p">:</span> <span class="kt">UIViewController</span><span class="p">,</span> <span class="kt">FlaskReactor</span>  <span class="p">{</span>

    <span class="kd">func</span> <span class="nf">flaskReactions</span><span class="p">(</span><span class="nv">reaction</span><span class="p">:</span> <span class="kt">FlaskReaction</span><span class="p">)</span> <span class="p">{</span>

        <span class="n">reaction</span><span class="o">.</span><span class="nf">on</span><span class="p">(</span><span class="kt">AppState</span><span class="o">.</span><span class="n">prop</span><span class="o">.</span><span class="n">counter</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="n">change</span><span class="p">)</span> <span class="k">in</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">"counter = </span><span class="se">\(</span><span class="n">substance</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">counter</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="p">}</span>

  <span class="k">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>

        <span class="kt">Flask</span><span class="o">.</span><span class="nf">attachReactor</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span><span class="k">self</span><span class="p">,</span> <span class="nv">mixing</span><span class="p">:[</span><span class="n">substance</span><span class="p">,</span> <span class="kt">Subs</span><span class="o">.</span><span class="n">appReactive</span><span class="p">])</span>

    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<h2 id='flux' class='heading'>Flux</h2>

<p>In Flask, Flux is the unidirectional single dispatch bus that ensures that all mixing operations will be performed in an atomic way.</p>

<p>All this happens under the hood and you don&rsquo;t need to interface with Flux other than dispatching SubstanceMixer events.</p>

<p>However, it is possible to pause the Flux with a <code><a href="Classes/FluxLock.html">FluxLock</a></code> and also perform exclusive mixes while the main flux is paused.  Even more, you can create asynchronous locks that would be released at a later time by actions performed in your reaction closure.</p>

<p>Read more about Locks below.</p>
<h2 id='new-to-flux' class='heading'>New to Flux?</h2>

<p>You can learn all about of Flux in this didactic article from Lin Clark.
<a href="https://code-cartoons.com/a-cartoon-guide-to-flux-6157355ab207">A cartoon guide to Flux</a></p>

<p>Also the official docs:
<a href="https://facebook.github.io/flux/docs/overview.html">Flux from facebook</a></p>
<h1 id='implementation' class='heading'>Implementation</h1>

<p>Here is a quick reference on how to implement Flask Reactor in relation to the Redux and Fluxor pattern.</p>
<h2 id='redux-style' class='heading'>Redux Style</h2>

<p>This is a gist of a basic ReSwift-like implementation. </p>

<blockquote>
<p>Substance.swift</p>
</blockquote>
<pre class="highlight swift"><code><span class="kd">struct</span> <span class="kt">AppState</span> <span class="p">:</span> <span class="kt">State</span><span class="p">{</span>

    <span class="kd">enum</span> <span class="nv">prop</span><span class="p">:</span> <span class="kt">StateProp</span><span class="p">{</span>
        <span class="k">case</span> <span class="n">counter</span><span class="p">,</span> <span class="n">text</span>
    <span class="p">}</span>

    <span class="k">var</span> <span class="nv">counter</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">var</span> <span class="nv">text</span> <span class="o">=</span> <span class="s">""</span>
<span class="p">}</span>
</code></pre>

<blockquote>
<p>ViewController</p>
</blockquote>
<pre class="highlight swift"><code><span class="kd">class</span> <span class="kt">ViewController</span><span class="p">:</span> <span class="kt">UIViewController</span><span class="p">,</span> <span class="kt">FlaskReactor</span>  <span class="p">{</span>

    <span class="kd">func</span> <span class="nf">flaskReactions</span><span class="p">(</span><span class="nv">reaction</span><span class="p">:</span> <span class="kt">FlaskReaction</span><span class="p">)</span> <span class="p">{</span>

        <span class="n">reaction</span><span class="o">.</span><span class="nf">on</span><span class="p">(</span><span class="kt">AppState</span><span class="o">.</span><span class="n">prop</span><span class="o">.</span><span class="n">counter</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="n">change</span><span class="p">)</span> <span class="k">in</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"counter = </span><span class="se">\(</span><span class="n">substance</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">counter</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="n">reaction</span><span class="o">.</span><span class="nf">on</span><span class="p">(</span><span class="kt">AppState</span><span class="o">.</span><span class="n">prop</span><span class="o">.</span><span class="n">text</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="n">change</span><span class="p">)</span> <span class="k">in</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"text = </span><span class="se">\(</span><span class="n">substance</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">text</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="p">}</span>

    <span class="p">}</span>

    <span class="k">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>

        <span class="kt">Flask</span><span class="o">.</span><span class="nf">attachReactor</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span><span class="k">self</span><span class="p">,</span> <span class="nv">mixing</span><span class="p">:[</span><span class="n">substance</span><span class="p">])</span>
        <span class="nf">produceTestReaction</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">produceTestReaction</span><span class="p">(){</span>

        <span class="kt">Flask</span><span class="o">.</span><span class="nf">getReactor</span><span class="p">(</span><span class="nv">attachedTo</span><span class="p">:</span><span class="k">self</span><span class="p">)</span>
            <span class="o">.</span><span class="nf">mixing</span><span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="n">substance</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="n">substance</span><span class="p">)</span> <span class="k">in</span>
                <span class="n">substance</span><span class="o">.</span><span class="n">prop</span><span class="o">.</span><span class="n">counter</span> <span class="o">=</span> <span class="mi">10</span>
            <span class="p">}</span><span class="o">.</span><span class="nf">with</span><span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="n">substance</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="n">substance</span><span class="p">)</span> <span class="k">in</span>
                <span class="n">substance</span><span class="o">.</span><span class="n">prop</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">"changed!"</span>
            <span class="p">}</span><span class="o">.</span><span class="nf">andReact</span><span class="p">()</span>

    <span class="p">}</span>

<span class="p">}</span>
</code></pre>
<h2 id='fluxor-style' class='heading'>Fluxor Style</h2>

<p>The fluxor pattern requires more setup but it&rsquo;s very convenient for shared substances.</p>

<blockquote>
<p>Manifest</p>
</blockquote>
<pre class="highlight swift"><code><span class="kd">enum</span> <span class="kt">EnvMixers</span> <span class="p">:</span> <span class="kt">SubstanceMixer</span> <span class="p">{</span>
    <span class="k">case</span> <span class="kt">Login</span>
    <span class="k">case</span> <span class="kt">Logout</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="kt">Subs</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="k">let</span> <span class="nv">appReactive</span> <span class="o">=</span> <span class="kt">AppReactiveSubstance</span><span class="p">()</span>
<span class="p">}</span>
</code></pre>

<blockquote>
<p>Substance.swift</p>
</blockquote>
<pre class="highlight swift"><code>
<span class="kd">struct</span> <span class="kt">AppState</span> <span class="p">:</span> <span class="kt">State</span> <span class="p">{</span>

    <span class="kd">enum</span> <span class="nv">prop</span> <span class="p">:</span> <span class="kt">StateProp</span><span class="p">{</span>
        <span class="k">case</span> <span class="n">counter</span><span class="p">,</span> <span class="n">title</span>
    <span class="p">}</span>

    <span class="k">var</span> <span class="nv">counter</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">var</span> <span class="nv">title</span> <span class="o">=</span> <span class="s">""</span>

<span class="p">}</span>

<span class="kd">class</span> <span class="kt">AppReactiveSubstance</span> <span class="p">:</span> <span class="kt">ReactiveSubstance</span><span class="o">&lt;</span><span class="kt">AppState</span><span class="p">,</span><span class="kt">EnvMixers</span><span class="o">&gt;</span> <span class="p">{</span>

    <span class="k">override</span> <span class="kd">func</span> <span class="nf">defineMixers</span><span class="p">(){</span>

        <span class="nf">define</span><span class="p">(</span><span class="nv">mix</span><span class="p">:</span> <span class="o">.</span><span class="kt">Login</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">react</span><span class="p">,</span> <span class="n">abort</span><span class="p">)</span>  <span class="k">in</span>
            <span class="k">self</span><span class="o">.</span><span class="n">prop</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">"signed"</span>
            <span class="nf">react</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>  
<span class="p">}</span>

</code></pre>

<blockquote>
<p>ViewController</p>
</blockquote>
<pre class="highlight swift"><code><span class="kd">class</span> <span class="kt">ViewController</span><span class="p">:</span> <span class="kt">UIViewController</span><span class="p">,</span> <span class="kt">FlaskReactor</span>  <span class="p">{</span>

    <span class="kd">func</span> <span class="nf">flaskReactions</span><span class="p">(</span><span class="nv">reaction</span><span class="p">:</span> <span class="kt">FlaskReaction</span><span class="p">)</span> <span class="p">{</span>

        <span class="n">reaction</span><span class="o">.</span><span class="nf">on</span><span class="p">(</span><span class="kt">AppState</span><span class="o">.</span><span class="n">prop</span><span class="o">.</span><span class="n">title</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="n">change</span><span class="p">)</span> <span class="k">in</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"global title = </span><span class="se">\(</span><span class="kt">Subs</span><span class="o">.</span><span class="n">appReactive</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">title</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="p">}</span>

    <span class="p">}</span>

    <span class="k">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>

        <span class="kt">Flask</span><span class="o">.</span><span class="nf">attachReactor</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span><span class="k">self</span><span class="p">,</span> <span class="nv">mixing</span><span class="p">:[</span><span class="kt">Subs</span><span class="o">.</span><span class="n">appReactive</span><span class="p">])</span>
        <span class="nf">produceTestReaction</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">produceTestReaction</span><span class="p">(){</span>

        <span class="kt">Flask</span><span class="o">.</span><span class="nf">substances</span><span class="p">(</span><span class="nv">reactTo</span><span class="p">:</span><span class="kt">EnvMixers</span><span class="o">.</span><span class="kt">Login</span><span class="p">,</span> <span class="nv">payload</span><span class="p">:[</span><span class="s">"username"</span><span class="p">:</span><span class="s">"foo"</span><span class="p">])</span>

     <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<h1 id='special-features' class='heading'>Special Features</h1>
<h3 id='chain-reactions' class='heading'>Chain Reactions</h3>

<p>A call to  <code>mix()</code> ( aka <code>mixing()</code> ) returns a Flask <code><a href="Classes/ChainReaction.html">ChainReaction</a></code> instance that can be futher chained until resolved.  A <code><a href="Classes/ChainReaction.html">ChainReaction</a></code> has the following methods:</p>

<ul>
<li>mix(substance:)</li>
<li>react()</li>
<li>abort()</li>
</ul>

<p>To continue the chain, just call mix (or any of its aliases) again. You must call <code>react()</code> or <code>abort()</code> (or its aliases) in order to resolve the transaction (otherwise your Flask will fail to perform further mix transactions).</p>

<blockquote>
<p>Using the high-level API</p>
</blockquote>
<pre class="highlight swift"><code> <span class="kt">Flask</span><span class="o">.</span><span class="nf">getReactor</span><span class="p">(</span><span class="nv">attachedTo</span><span class="p">:</span><span class="k">self</span><span class="p">)</span>
            <span class="o">.</span><span class="nf">mixing</span><span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="n">substanceA</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="n">substance</span><span class="p">)</span> <span class="k">in</span>
                <span class="n">substance</span><span class="o">.</span><span class="n">prop</span><span class="o">.</span><span class="n">counter</span> <span class="o">=</span> <span class="mi">10</span>

            <span class="p">}</span><span class="o">.</span><span class="nf">with</span><span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="n">substanceB</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="n">substance</span><span class="p">)</span> <span class="k">in</span>
                <span class="n">substance</span><span class="o">.</span><span class="n">prop</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">"text"</span>

            <span class="p">}</span><span class="o">.</span><span class="nf">andReact</span><span class="p">()</span>
</code></pre>

<blockquote>
<p>Using the low level API</p>
</blockquote>
<pre class="highlight swift"><code>   <span class="n">reactorInstance</span>
       <span class="o">.</span><span class="nf">mix</span><span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="n">substanceA</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="n">substance</span><span class="p">)</span> <span class="k">in</span>
            <span class="n">substance</span><span class="o">.</span><span class="n">prop</span><span class="o">.</span><span class="n">counter</span> <span class="o">=</span> <span class="mi">10</span>

        <span class="p">}</span><span class="o">.</span><span class="nf">mix</span><span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="n">substanceB</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="n">substance</span><span class="p">)</span> <span class="k">in</span>
            <span class="n">substance</span><span class="o">.</span><span class="n">prop</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">"text"</span>

        <span class="p">}</span><span class="o">.</span><span class="nf">react</span><span class="p">()</span>
</code></pre>
<h3 id='locks' class='heading'>Locks</h3>

<p>When needed you can create a <code><a href="Classes/FluxLock.html">FluxLock</a></code>. This will pause performing any mixes including <code>ReactiveSubstances</code> or <code>ChainReactions</code>.  You can create many Locks but you are responsible for releasing them all too reactive the flux.</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">lock</span> <span class="o">=</span> <span class="kt">Flask</span><span class="o">.</span><span class="nf">lock</span><span class="p">()</span>

<span class="c1">// perform operations while the flux is paused</span>

<span class="n">lock</span><span class="o">.</span><span class="nf">release</span><span class="p">()</span>
</code></pre>
<h3 id='async-mixing-with-locks' class='heading'>Async Mixing with Locks</h3>

<p>Sometimes you need to perform a particular Mix operation that requires to pause all other mixings until the <code><a href="Classes/FlaskReaction.html">FlaskReaction</a></code> is resolved.</p>

<p>Performing this is really simple using a <code><a href="Classes/ReactiveSubstance.html">ReactiveSubstance</a></code> </p>

<ul>
<li>Just create a <code><a href="Classes/FluxLock.html">FluxLock</a></code> passing the name of your global EnvMixer.</li>
<li>Perform your <code><a href="Classes/ReactiveSubstance.html">ReactiveSubstance</a></code> mix as usual</li>
<li>Then in the <code>FluxReactor</code> inside the <code>FluxReaction</code> instance, you&rsquo;ll receive a pointer to your lock at  <code>reaction.onLock?</code> so you can release it.</li>
</ul>

<p>Example:</p>

<blockquote>
<p>Request a Mix over a locked flux</p>
</blockquote>
<pre class="highlight swift"><code>        <span class="kt">Flask</span><span class="o">.</span><span class="nf">lock</span><span class="p">(</span><span class="nv">withMixer</span><span class="p">:</span> <span class="kt">EnvMixers</span><span class="o">.</span><span class="kt">AsyncAction</span><span class="p">)</span>
</code></pre>

<blockquote>
<p>Async Release</p>
</blockquote>
<pre class="highlight swift"><code> <span class="n">reaction</span><span class="o">.</span><span class="nf">on</span><span class="p">(</span><span class="kt">AppState</span><span class="o">.</span><span class="n">prop</span><span class="o">.</span><span class="n">asyncResult</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="n">change</span><span class="p">)</span> <span class="k">in</span>

            <span class="c1">//pass the reaction to an async block </span>

            <span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="nf">asyncAfter</span><span class="p">(</span><span class="nv">deadline</span><span class="p">:</span> <span class="o">.</span><span class="nf">now</span><span class="p">()</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="nv">execute</span><span class="p">:</span> <span class="p">{</span>
                <span class="c1">//release when the operation is completed</span>
                <span class="n">reaction</span><span class="o">.</span><span class="n">onLock</span><span class="p">?</span><span class="o">.</span><span class="nf">release</span><span class="p">()</span>
            <span class="p">});</span>

   <span class="p">}</span>

</code></pre>
<h3 id='nested-structs' class='heading'>Nested Structs</h3>

<p>It&rsquo;s possible to use nested structs and Observe changes in them. The limitation around Structs is that all properties must conform to the Codable protocol.</p>

<p>If you need to support passing objects as top-level properties or nested, read below regarding Nested Dictionaries.</p>
<pre class="highlight swift"><code>
<span class="kd">func</span> <span class="nf">testStruct</span><span class="p">(){</span>

        <span class="k">let</span> <span class="nv">expectation</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="nf">expectation</span><span class="p">(</span><span class="nv">description</span><span class="p">:</span> <span class="s">"testStruct"</span><span class="p">)</span>
        <span class="k">let</span> <span class="nv">expectation2</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="nf">expectation</span><span class="p">(</span><span class="nv">description</span><span class="p">:</span> <span class="s">"testStruct"</span><span class="p">)</span>
        <span class="k">let</span> <span class="nv">expectation3</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="nf">expectation</span><span class="p">(</span><span class="nv">description</span><span class="p">:</span> <span class="s">"testStruct"</span><span class="p">)</span>

        <span class="kd">struct</span> <span class="nv">nestedTestStruct</span><span class="p">:</span><span class="kt">Codable</span><span class="p">{</span>
            <span class="k">var</span> <span class="nv">foo</span> <span class="o">=</span> <span class="s">"bar"</span>
            <span class="k">var</span> <span class="nv">object</span> <span class="o">=</span> <span class="kt">FlaskNSRef</span><span class="p">(</span><span class="kt">NSObject</span><span class="p">())</span>
        <span class="p">}</span>

        <span class="kd">struct</span> <span class="nv">testStruct</span><span class="p">:</span><span class="kt">Codable</span><span class="p">{</span>
            <span class="k">var</span> <span class="nv">counter</span> <span class="o">=</span> <span class="mi">10</span>
            <span class="k">var</span> <span class="nv">nest</span> <span class="o">=</span> <span class="nf">nestedTestStruct</span><span class="p">()</span>
        <span class="p">}</span>

        <span class="kd">struct</span> <span class="nv">state</span> <span class="p">:</span> <span class="kt">State</span><span class="p">{</span>
            <span class="k">var</span> <span class="nv">info</span> <span class="o">=</span> <span class="nf">testStruct</span><span class="p">()</span>
        <span class="p">}</span>

        <span class="k">let</span> <span class="nv">NAME</span> <span class="o">=</span> <span class="s">"substanceTest</span><span class="se">\(</span> <span class="kt">NSDate</span><span class="p">()</span><span class="o">.</span><span class="n">timeIntervalSince1970</span><span class="se">)</span><span class="s">"</span>
        <span class="k">let</span> <span class="nv">mySubstance</span> <span class="o">=</span> <span class="kt">Flask</span><span class="o">.</span><span class="nf">newSubstance</span><span class="p">(</span><span class="nv">definedBy</span><span class="p">:</span> <span class="n">state</span><span class="o">.</span><span class="k">self</span><span class="p">,</span><span class="nv">named</span><span class="p">:</span><span class="kt">NAME</span><span class="p">,</span> <span class="nv">archive</span><span class="p">:</span><span class="kc">false</span><span class="p">)</span>
        <span class="n">mySubstance</span><span class="o">.</span><span class="n">shouldArchive</span> <span class="o">=</span> <span class="kc">true</span>

        <span class="k">let</span> <span class="nv">owner</span><span class="p">:</span><span class="kt">TestOwner</span> <span class="o">=</span> <span class="kt">TestOwner</span><span class="p">()</span>
        <span class="k">let</span> <span class="nv">reactor</span> <span class="o">=</span> <span class="kt">Flask</span><span class="o">.</span><span class="nf">reactor</span><span class="p">(</span><span class="nv">attachedTo</span><span class="p">:</span><span class="n">owner</span><span class="p">,</span> <span class="nv">mixing</span><span class="p">:</span><span class="n">mySubstance</span><span class="p">)</span>


        <span class="n">reactor</span><span class="o">.</span><span class="n">handler</span> <span class="o">=</span> <span class="p">{</span> <span class="n">owner</span><span class="p">,</span> <span class="n">reaction</span> <span class="k">in</span>

            <span class="n">mySubstance</span><span class="o">.</span><span class="nf">archiveNow</span><span class="p">()</span>

            <span class="n">reaction</span><span class="o">.</span><span class="nf">on</span><span class="p">(</span><span class="s">"info"</span><span class="p">,</span> <span class="p">{</span> <span class="p">(</span><span class="n">change</span><span class="p">)</span> <span class="k">in</span>
                <span class="n">expectation</span><span class="o">.</span><span class="nf">fulfill</span><span class="p">()</span>
            <span class="p">})</span>
            <span class="n">reaction</span><span class="o">.</span><span class="nf">on</span><span class="p">(</span><span class="s">"info.counter"</span><span class="p">,</span> <span class="p">{</span> <span class="p">(</span><span class="n">change</span><span class="p">)</span> <span class="k">in</span>
                <span class="n">expectation2</span><span class="o">.</span><span class="nf">fulfill</span><span class="p">()</span>
            <span class="p">})</span>
            <span class="n">reaction</span><span class="o">.</span><span class="nf">on</span><span class="p">(</span><span class="s">"info.nest.foo"</span><span class="p">,</span> <span class="p">{</span> <span class="p">(</span><span class="n">change</span><span class="p">)</span> <span class="k">in</span>
                <span class="n">expectation3</span><span class="o">.</span><span class="nf">fulfill</span><span class="p">()</span>
            <span class="p">})</span>
        <span class="p">}</span>

        <span class="n">reactor</span><span class="o">.</span><span class="nf">mix</span><span class="p">(</span><span class="n">mySubstance</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="n">substance</span><span class="p">)</span> <span class="k">in</span>
            <span class="n">substance</span><span class="o">.</span><span class="n">prop</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">counter</span> <span class="o">=</span> <span class="mi">90</span>
            <span class="n">substance</span><span class="o">.</span><span class="n">prop</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">nest</span><span class="o">.</span><span class="n">foo</span> <span class="o">=</span> <span class="s">"mutated"</span>
            <span class="p">}</span><span class="o">.</span><span class="nf">andReact</span><span class="p">()</span>

        <span class="nf">wait</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="p">[</span><span class="n">expectation</span><span class="p">,</span><span class="n">expectation2</span><span class="p">,</span><span class="n">expectation3</span><span class="p">],</span> <span class="nv">timeout</span><span class="p">:</span> <span class="mi">2</span><span class="p">)</span>

        <span class="k">let</span> <span class="nv">expectation4</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="nf">expectation</span><span class="p">(</span><span class="nv">description</span><span class="p">:</span> <span class="s">"must preserve after archive"</span><span class="p">)</span>

        <span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="nf">asyncAfter</span><span class="p">(</span><span class="nv">deadline</span><span class="p">:</span> <span class="o">.</span><span class="nf">now</span><span class="p">()</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>

            <span class="k">let</span> <span class="nv">archivedSubstance</span> <span class="o">=</span> <span class="kt">Flask</span><span class="o">.</span><span class="nf">newSubstance</span><span class="p">(</span><span class="nv">definedBy</span><span class="p">:</span> <span class="n">state</span><span class="o">.</span><span class="k">self</span><span class="p">,</span><span class="nv">named</span><span class="p">:</span><span class="kt">NAME</span><span class="p">,</span><span class="nv">archive</span><span class="p">:</span><span class="kc">true</span><span class="p">)</span>
            <span class="kt">XCTAssert</span><span class="p">(</span><span class="n">archivedSubstance</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">nest</span><span class="o">.</span><span class="n">foo</span> <span class="o">==</span> <span class="s">"mutated"</span><span class="p">,</span> <span class="s">"Must preserve value"</span><span class="p">)</span>
            <span class="n">expectation4</span><span class="o">.</span><span class="nf">fulfill</span><span class="p">()</span>
        <span class="p">}</span>

        <span class="nf">wait</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="p">[</span><span class="n">expectation4</span><span class="p">],</span> <span class="nv">timeout</span><span class="p">:</span> <span class="mi">4</span><span class="p">)</span>
    <span class="p">}</span>
</code></pre>
<h3 id='nsobjects-and-dictionaries' class='heading'>NSObjects and Dictionaries</h3>

<p><strong>Objects and Archiving</strong> : <em>Please consider that NSObjects are not serializable and will be mapped to <code>nil</code> by the <code><a href="Classes/SubstanceSerializer.html">SubstanceSerializer</a></code></em></p>

<p>In case you need to observe changes in NSObject you can use <code>FlaskRef</code>. This will wrap your object inside a class that supports the Codable protocol required by your State struct.</p>

<p>When observing this keys you&rsquo;ll be notified whenever the object pointer to this object changes. This would allow you to observe changes in UI objects like UIViewController.</p>
<pre class="highlight swift"><code><span class="kd">struct</span> <span class="nv">myState</span> <span class="p">:</span> <span class="kt">State</span><span class="p">{</span>
   <span class="k">var</span> <span class="nv">object</span> <span class="o">=</span> <span class="kt">FlaskRef</span><span class="p">(</span> <span class="kt">NSObject</span><span class="p">()</span> <span class="p">)</span>
<span class="p">}</span>

</code></pre>

<p>In case you need to deal with a hierarchy of nested objects the <code><a href="Classes/FlaskDictRef.html">FlaskDictRef</a></code> comes to the rescue.  Initialize an instance of this class with an NSDictionary and then you&rsquo;ll be able to observe changes on nested keys.</p>

<ul>
<li>In your state create a <code><a href="Classes/FlaskDictRef.html">FlaskDictRef</a></code> property</li>
<li>Assign new values by wrapping your Dictionary in a <code>FlaskDictRef( Dictionary )</code></li>
<li>Observe changes in your nested keys using dot syntax.</li>
</ul>

<p>Example:</p>

<blockquote>
<p>Create a FlaskDictRef property</p>
</blockquote>
<pre class="highlight swift"><code><span class="kd">struct</span> <span class="kt">AppState</span> <span class="p">:</span> <span class="kt">State</span> <span class="p">{</span>

    <span class="kd">enum</span> <span class="nv">prop</span> <span class="p">:</span> <span class="kt">StateProp</span><span class="p">{</span>
        <span class="k">case</span> <span class="n">info</span>
    <span class="p">}</span>

    <span class="k">var</span> <span class="nv">info</span><span class="p">:</span><span class="kt">FlaskDictRef</span><span class="p">?</span>
<span class="p">}</span>

</code></pre>

<blockquote>
<p>Assign values</p>
</blockquote>
<pre class="highlight swift"><code> <span class="n">reactor</span><span class="o">.</span><span class="nf">mix</span><span class="p">(</span><span class="n">substance</span><span class="p">){</span> <span class="p">(</span><span class="n">substance</span><span class="p">)</span> <span class="k">in</span>

          <span class="k">let</span> <span class="nv">data</span><span class="p">:</span><span class="kt">NSDictionary</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s">"foo"</span><span class="p">:</span><span class="s">"bar"</span><span class="p">,</span>
            <span class="s">"nest"</span><span class="p">:[</span>
                <span class="s">"data"</span><span class="p">:</span><span class="s">"some"</span>
            <span class="p">]</span>

        <span class="p">]</span>

       <span class="n">substance</span><span class="o">.</span><span class="n">prop</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="kt">FlaskDictRef</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

  <span class="p">}</span><span class="o">.</span><span class="nf">react</span><span class="p">()</span>

</code></pre>

<blockquote>
<p>Observe changes</p>
</blockquote>
<pre class="highlight swift"><code> <span class="n">reaction</span><span class="o">.</span><span class="nf">on</span><span class="p">(</span><span class="s">"info.nest.data"</span><span class="p">,</span> <span class="p">{</span> <span class="p">(</span><span class="n">change</span><span class="p">)</span> <span class="k">in</span>
      <span class="nf">print</span><span class="p">(</span><span class="n">change</span><span class="o">.</span><span class="nf">newValue</span><span class="p">()</span><span class="o">!</span><span class="p">)</span>
 <span class="p">})</span>
</code></pre>
<h3 id='archiving' class='heading'>Archiving</h3>

<p>Archiving is a great alternative to SQL-Lite or CoreData when you don&rsquo;t need to perform queries or relational operations in your data. Consider that this feature relies on UserDefaults as storage destination.</p>

<p>By default, archiving is off. To Enable archiving you just need to pass two extra parameters to the <code><a href="Classes.html#/s:9Flask_iOS9SubstanceC">Substance</a></code> or <code><a href="Classes/ReactiveSubstance.html">ReactiveSubstance</a></code> initializer:</p>
<pre class="highlight plaintext"><code>let substance = MySubstanceClass(name:"uniqueName",archive:true)
</code></pre>

<p>The name has to be unique so make sure to use a proper naming convention for your app.</p>

<p>The substances are then archived after being ile for 2 seconds when changes are detected. It&rsquo;s possible to disable archiving after instantiation by using the property <code>Substance.shouldArchive</code>.</p>

<p>You can further customize the process by overriding any of the following methods in your Substances subclasses:</p>
<pre class="highlight swift"><code>    <span class="k">override</span> <span class="kd">func</span> <span class="nf">archiveKeySpace</span><span class="p">()</span><span class="o">-&gt;</span><span class="kt">String</span><span class="p">{</span>
        <span class="k">return</span> <span class="s">"1"</span>
    <span class="p">}</span>

    <span class="k">override</span> <span class="kd">func</span> <span class="nf">archiveKey</span><span class="p">()</span><span class="o">-&gt;</span><span class="kt">String</span><span class="p">{</span>
        <span class="k">return</span> <span class="s">"Fx.</span><span class="se">\(</span><span class="nf">archiveKeySpace</span><span class="p">()</span><span class="se">)</span><span class="s">.</span><span class="se">\(</span><span class="nf">name</span><span class="p">()</span><span class="se">)</span><span class="s">"</span>
    <span class="p">}</span>

    <span class="k">override</span> <span class="kd">func</span> <span class="nf">archiveDelay</span><span class="p">()</span><span class="o">-&gt;</span><span class="kt">Double</span><span class="p">{</span>
        <span class="k">return</span> <span class="mf">2.0</span>
    <span class="p">}</span>

    <span class="k">override</span> <span class="kd">func</span> <span class="nf">archiveDisabled</span><span class="p">()</span><span class="o">-&gt;</span><span class="kt">Bool</span><span class="p">{</span>
        <span class="k">return</span> <span class="o">!</span><span class="n">shouldArchive</span>
    <span class="p">}</span>
</code></pre>
<h3 id='internal-state-props' class='heading'>Internal state props</h3>

<p>In case you want to ignore some State properties from being used in the changes reduction, just use the <code>_</code> prefix on the variable name:</p>
<pre class="highlight swift"><code><span class="kd">struct</span> <span class="kt">AppState</span> <span class="p">:</span> <span class="kt">State</span> <span class="p">{</span>

    <span class="k">var</span> <span class="nv">_internal</span> <span class="o">=</span> <span class="s">"`_` use this prefix for internal vars "</span>

<span class="p">}</span>
</code></pre>

<p>This could be useful if for whatever reason you are performing additional computations in your state. </p>
<h3 id='low-level-api' class='heading'>Low-level API</h3>

<p>Behind the scenes, most high-level functions rely on calling stating methods on the main <code><a href="Classes/Flask.html">Flask</a></code> class.</p>

<p>You can see them all <a href="file:///Users/hassanvfx/projects/eonflux/reactor/docs/Classes/Flask.html">here</a>:</p>
<pre class="highlight swift"><code><span class="nf">purgeFluxQueue</span><span class="p">()</span>
<span class="nf">purgeFlasks</span><span class="p">()</span>

<span class="nf">instance</span><span class="p">(</span><span class="nv">attachedTo</span><span class="p">:</span><span class="nv">mixing</span><span class="p">:)</span>
<span class="nf">instance</span><span class="p">(</span><span class="nv">attachedTo</span><span class="p">:</span><span class="nv">mixing</span><span class="p">:)</span>

<span class="nf">lock</span><span class="p">()</span>
<span class="nf">lock</span><span class="p">(</span><span class="nv">withMixer</span><span class="p">:)</span>
<span class="nf">lock</span><span class="p">(</span><span class="nv">withMixer</span><span class="p">:</span><span class="nv">payload</span><span class="p">:)</span>
<span class="nf">removeLocks</span><span class="p">()</span>

<span class="nf">applyMixer</span><span class="p">(</span><span class="nv">_</span><span class="p">:</span><span class="nv">payload</span><span class="p">:)</span>

<span class="nf">attachReactor</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span><span class="nv">mixing</span><span class="p">:)</span>
<span class="nf">detachReactor</span><span class="p">(</span><span class="nv">from</span><span class="p">:)</span>
</code></pre>

<p>You can also access the <code><a href="Classes/ReactorManager.html">ReactorManager</a></code> that holds all the attached <code><a href="Classes/Reactor.html">Reactor</a></code> instances</p>
<pre class="highlight swift"><code><span class="n">reactors</span>
<span class="nf">purge</span><span class="p">()</span>
</code></pre>
<h1 id='documentation' class='heading'>Documentation</h1>
<h2 id='demo-project' class='heading'>Demo Project</h2>

<p>A sample project is available in this repo inside the folder: </p>

<ul>
<li>FlaskSample/</li>
</ul>

<p>Make sure to run <code>Pod install</code> to create your workspace.</p>

<p>The sample application implements both patterns simultaneously for further reference.</p>
<h2 id='test-cases' class='heading'>Test Cases</h2>

<p>The above sample project also ships with dozens of test cases as standard Xcode test units. It&rsquo;s a great source to learn more implementation patterns.</p>

<p>These tests are also automatically run with Travis-CI on each deployment and you can check the health status above for peace of mind.</p>
<h2 id='gists' class='heading'>Gists</h2>

<p>More practical examples are in the works and we would love to feature yours!</p>
<h2 id='api-documentation' class='heading'>API Documentation</h2>

<blockquote>
<p><em>Please note the documentation is work in progress.</em></p>
</blockquote>

<p>Jazzy generated documentation available here: <a href="https://eonfluxor.github.io/reactor/">Documentation</a></p>
<h2 id='have-a-question' class='heading'>Have a question?</h2>

<p>If you need any help, please visit our GitHub issues. Feel free to file an issue if you do not manage to find any solution from the archives.</p>

<p>You can also reach us at: </p>

<p><code>eonfluxor@gmail.com</code></p>
<h2 id='about' class='heading'>About</h2>

<p><strong>Flask</strong> was created by <a href="http://linkedin.com/in/hassanvfx">Hassan Uriostegui</a> </p>

          </div>
        </section>


      </article>
    </div>
    <section class="footer">
      <p>&copy; 2018 <a class="link" href="https://eonflux.io/" target="_blank" rel="external">Eonflux</a>. All rights reserved. (Last updated: 2018-09-21)</p>
      <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.9.3</a>, a <a class="link" href="https://realm.io" target="_blank" rel="external">Realm</a> project.</p>
    </section>
  </body>
</div>
</html>
